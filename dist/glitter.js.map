{"version":3,"sources":["webpack://Glitter/webpack/universalModuleDefinition","webpack://Glitter/webpack/bootstrap","webpack://Glitter/./js/glitter-detector.js","webpack://Glitter/./js/glitter-module.js","webpack://Glitter/./js/grayscale.js","webpack://Glitter/./js/index.js","webpack://Glitter/./js/shaders/flip-image.glsl","webpack://Glitter/./js/shaders/grayscale.glsl","webpack://Glitter/./js/utils/gl-utils.js","webpack://Glitter/./js/utils/utils.js"],"names":["GlitterDetector","constructor","code","targetFps","width","height","video","fpsInterval","imageData","document","createElement","setAttribute","grayScaleMedia","GrayScaleMedia","_onInit","source","startTick","setInterval","tick","bind","glitterModule","GlitterModule","initEvent","CustomEvent","detail","dispatchEvent","start","requestStream","then","catch","err","console","warn","performance","now","getPixels","mid","quads","track","end","log","tagEvent","tags","callback","_this","ready","shouldTrack","validPoints","GlitterWASM","Module","onWasmInit","_Module","_init","cwrap","_track","im_arr","im_ptr","_malloc","length","HEAPU8","set","ptr","ptrF64","Float64Array","BYTES_PER_ELEMENT","numQuads","getValue","i","q","p00","HEAPF64","p01","p10","p11","p20","p21","p30","p31","c0","c1","push","_free","canvas","gl","GLUtils","createGL","flipProg","require","grayProg","program","createProgram","useProgram","positionLocation","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","flipLocation","getUniformLocation","uniform1f","texture","createTexture","bindTexture","glReady","pixelBuf","Uint8ClampedArray","grayBuf","undefined","updateElem","draw","readPixels","j","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","aspect","Utils","isMobile","audio","ideal","aspectRatio","facingMode","stream","srcObject","onloadedmetadata","e","play","bindElem","getContext","viewport","clearColor","clear","COLOR_BUFFER_BIT","vertices","Float32Array","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","createShader","type","shaderProg","shader","shaderSource","compileShader","vertShaderProg","fragShaderProg","vertShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","attachShader","linkProgram","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","elem","texSubImage2D","destroyTexture","deleteTexture","createFramebuffer","fbo","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","destroyFramebuffer","deleteFramebuffer","drawArrays","TRIANGLES","test","userAgent"],"mappings":"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","file":"glitter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Glitter\"] = factory();\n\telse\n\t\troot[\"Glitter\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/index.js\");\n","import {GrayScaleMedia} from \"./grayscale\"\nimport {GlitterModule} from \"./glitter-module\"\n\nexport class GlitterDetector {\n    constructor(code, targetFps, width, height, video) {\n        this.code = code;\n        this.fpsInterval = 1000 / targetFps; // ms\n\n        this.width = width;\n        this.height = height;\n\n        this.imageData = null;\n\n        if (video) {\n            this.video = video;\n        }\n        else {\n            this.video = document.createElement(\"video\");\n            this.video.setAttribute(\"autoplay\", \"\");\n            this.video.setAttribute(\"muted\", \"\");\n            this.video.setAttribute(\"playsinline\", \"\");\n        }\n\n        this.grayScaleMedia = new GrayScaleMedia(this.video, this.width, this.height);\n    }\n\n    _onInit(source) {\n        function startTick() {\n            setInterval(this.tick.bind(this), this.fpsInterval);\n        }\n\n        this.glitterModule = new GlitterModule(this.code, startTick.bind(this));\n        const initEvent = new CustomEvent(\"onGlitterInit\", { detail: { source: source } });\n        document.dispatchEvent(initEvent);\n    }\n\n    start() {\n        this.grayScaleMedia.requestStream()\n            .then(source => {\n                this._onInit(source);\n            })\n            .catch(err => {\n                console.warn(\"ERROR: \" + err);\n            });\n    }\n\n    tick() {\n        const start = performance.now();\n\n        this.imageData = this.grayScaleMedia.getPixels();\n\n        const mid = performance.now();\n\n        const quads = this.glitterModule.track(this.imageData, this.width, this.height);\n\n        const end = performance.now();\n\n        if (end-start > this.fpsInterval) {\n            console.log(\"getPixels:\", mid-start, \"quads:\", end-mid, \"total:\", end-start);\n        }\n\n        if (quads) {\n            const tagEvent = new CustomEvent(\"onGlitterTagsFound\", { detail: { tags: quads } });\n            document.dispatchEvent(tagEvent);\n        }\n    }\n}\n","export class GlitterModule {\n    constructor(code, callback) {\n        let _this = this;\n        this.ready = false;\n        this.shouldTrack = false;\n        this.validPoints = false;\n        this.code = code;\n\n        GlitterWASM().then(function (Module) {\n            console.log(\"GLITTER WASM module loaded.\");\n            _this.onWasmInit(Module);\n            if (callback) callback();\n        });\n    }\n\n    onWasmInit(Module) {\n        this._Module = Module;\n        this._init = Module.cwrap(\"init\", \"number\", [\"number\"]);\n        this._track = this._Module.cwrap(\"track\", \"number\", [\"number\", \"number\", \"number\"]);\n        this.ready = (this._init(this.code) == 0);\n    }\n\n    track(im_arr, width, height) {\n        let quads = [];\n        if (!this.ready) return quads;\n\n        const im_ptr = this._Module._malloc(im_arr.length);\n        this._Module.HEAPU8.set(im_arr, im_ptr);\n\n        const ptr = this._track(im_ptr, width, height);\n        const ptrF64 = ptr / Float64Array.BYTES_PER_ELEMENT;\n\n        const numQuads = this._Module.getValue(ptr, \"double\");\n        // console.log(\"numQuads = \", numQuads);\n\n        for (var i = 0; i < numQuads; i++) {\n            var q = {\n                p00 : this._Module.HEAPF64[ptrF64+10*i+1+0],\n                p01 : this._Module.HEAPF64[ptrF64+10*i+1+1],\n                p10 : this._Module.HEAPF64[ptrF64+10*i+1+2],\n                p11 : this._Module.HEAPF64[ptrF64+10*i+1+3],\n                p20 : this._Module.HEAPF64[ptrF64+10*i+1+4],\n                p21 : this._Module.HEAPF64[ptrF64+10*i+1+5],\n                p30 : this._Module.HEAPF64[ptrF64+10*i+1+6],\n                p31 : this._Module.HEAPF64[ptrF64+10*i+1+7],\n                c0  : this._Module.HEAPF64[ptrF64+10*i+1+8],\n                c1  : this._Module.HEAPF64[ptrF64+10*i+1+9],\n            };\n            quads.push(q);\n        }\n\n        this._Module._free(ptr);\n        this._Module._free(im_ptr);\n\n        return quads;\n    }\n}\n","import {Utils} from './utils/utils';\nimport {GLUtils} from './utils/gl-utils';\n\nexport class GrayScaleMedia {\n    constructor(source, width, height, canvas) {\n        this.source = source;\n\n        this.width = width;\n        this.height = height;\n\n        this.canvas = canvas ? canvas : document.createElement(\"canvas\");\n        this.canvas.width = this.width;\n        this.canvas.height = this.height;\n\n        this.gl = GLUtils.createGL(this.canvas, this.width, this.height);\n\n        const flipProg = require(\"./shaders/flip-image.glsl\");\n        const grayProg = require(\"./shaders/grayscale.glsl\");\n        const program = GLUtils.createProgram(this.gl, flipProg, grayProg);\n        GLUtils.useProgram(this.gl, program);\n\n        const positionLocation = this.gl.getAttribLocation(program, \"position\");\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n        this.gl.enableVertexAttribArray(positionLocation);\n\n        const flipLocation = this.gl.getUniformLocation(program, \"flipY\");\n        this.gl.uniform1f(flipLocation, -1); // flip image\n\n        this.texture = GLUtils.createTexture(this.gl, this.width, this.height);\n        GLUtils.bindTexture(this.gl, this.texture);\n\n        this.glReady = true;\n        this.pixelBuf = new Uint8ClampedArray(this.width * this.height * 4);\n        this.grayBuf = new Uint8ClampedArray(this.width * this.height);\n    }\n\n    getPixels() {\n        if (!this.glReady) return undefined;\n\n        GLUtils.updateElem(this.gl, this.source);\n        GLUtils.draw(this.gl);\n        GLUtils.readPixels(this.gl, this.width, this.height, this.pixelBuf);\n\n        let j = 0;\n        for (let i = 0; i < this.pixelBuf.length; i += 4) {\n            this.grayBuf[j] = this.pixelBuf[i];\n            j++;\n        }\n        return this.grayBuf;\n    }\n\n    requestStream() {\n        return new Promise((resolve, reject) => {\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n                return reject();\n\n            // Hack for mobile browsers: aspect ratio is flipped.\n            var aspect = this.width / this.height;\n            if (Utils.isMobile()) {\n                aspect = 1 / aspect;\n            }\n\n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { ideal: this.width },\n                    height: { ideal: this.height },\n                    aspectRatio: { ideal: aspect },\n                    facingMode: \"environment\"\n                }\n            })\n            .then(stream => {\n                this.source.srcObject = stream;\n                this.source.onloadedmetadata = e => {\n                    this.source.play();\n                    GLUtils.bindElem(this.gl, this.source);\n                    resolve(this.source);\n                };\n            })\n            .catch(err => {\n                reject(err);\n            });\n        });\n    }\n}\n","import {GlitterDetector} from \"./glitter-detector\"\n\nexport {\n    GlitterDetector\n}\n","module.exports = \"attribute vec2 position;\\nvarying vec2 tex_coords;\\nuniform float flipY;\\nvoid main(void) {\\ntex_coords = (position + 1.0) / 2.0;\\ntex_coords.y = 1.0 - tex_coords.y;\\ngl_Position = vec4(position * vec2(1, flipY), 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nuniform sampler2D u_image;\\nvarying vec2 tex_coords;\\nconst vec3 g = vec3(0.299, 0.587, 0.114);\\nvoid main(void) {\\nvec4 color = texture2D(u_image, tex_coords);\\nfloat gray = dot(color.rgb, g);\\ngl_FragColor = vec4(vec3(gray), 1.0);\\n}\"","export class GLUtils {\n    static createGL(canvas, width, height) {\n        const gl = canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\");\n        gl.viewport(0, 0, width, height);\n        gl.clearColor(0.1, 0.1, 0.1, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        const vertices = new Float32Array([\n            -1, -1,\n            -1,  1,\n             1,  1,\n            -1, -1,\n             1,  1,\n             1, -1,\n        ]);\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n        return gl;\n    }\n\n    static createShader(gl, type, shaderProg) {\n        const shader = gl.createShader(type);\n\n        gl.shaderSource(shader, shaderProg);\n        gl.compileShader(shader);\n\n        return shader;\n    }\n\n    static createProgram(gl, vertShaderProg, fragShaderProg) {\n        const vertShader = GLUtils.createShader(gl, gl.VERTEX_SHADER, vertShaderProg);\n        const fragShader = GLUtils.createShader(gl, gl.FRAGMENT_SHADER, fragShaderProg);\n\n        const program = gl.createProgram();\n        gl.attachShader(program, vertShader);\n        gl.attachShader(program, fragShader);\n\n        gl.linkProgram(program);\n\n        return program;\n    }\n\n    static useProgram(gl, program) {\n        gl.useProgram(program);\n    }\n\n    static createTexture(gl, width, height) {\n        const texture = gl.createTexture();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n\n        // if either dimension of image is not a power of 2\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n\n    static bindTexture(gl, texture) {\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        return texture;\n    }\n\n    static bindElem(gl, elem) {\n        gl.texImage2D(\n            gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, elem);\n    }\n\n    static updateElem(gl, elem) {\n        gl.texSubImage2D(\n            gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, elem);\n    }\n\n    static destroyTexture(gl, texture) {\n        gl.deleteTexture(texture);\n    }\n\n    static createFramebuffer(gl, texture) {\n        const fbo = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n        gl.framebufferTexture2D(\n            gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n        return fbo;\n    }\n\n    static destroyFramebuffer(gl, fbo) {\n        gl.deleteFramebuffer(fbo);\n    }\n\n    static draw(gl) {\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    static readPixels(gl, width, height, buffer) {\n        gl.readPixels(\n            0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, buffer);\n    }\n}\n","export class Utils {\n    static isMobile () {\n        return /Android|mobile|iPad|iPhone/i.test(navigator.userAgent);\n    }\n}\n"],"sourceRoot":""}