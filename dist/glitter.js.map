{"version":3,"sources":["webpack://Glitter/webpack/universalModuleDefinition","webpack://Glitter/webpack/bootstrap","webpack://Glitter/./js/gl-utils.js","webpack://Glitter/./js/glitter-detector.js","webpack://Glitter/./js/grayscale.js","webpack://Glitter/./js/index.js","webpack://Glitter/./js/shaders/flip-image.glsl","webpack://Glitter/./js/shaders/grayscale.glsl","webpack://Glitter/./js/utils.js"],"names":["GLUtils","createGL","canvas","width","height","gl","getContext","viewport","clearColor","clear","COLOR_BUFFER_BIT","vertices","Float32Array","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","createShader","type","shaderProg","shader","shaderSource","compileShader","createProgram","vertShaderProg","fragShaderProg","vertShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","program","attachShader","linkProgram","useProgram","createTexture","texture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","bindElem","elem","updateElem","texSubImage2D","destroyTexture","deleteTexture","createFramebuffer","fbo","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","destroyFramebuffer","deleteFramebuffer","draw","drawArrays","TRIANGLES","readPixels","GlitterDetector","constructor","code","callback","_this","ready","shouldTrack","validPoints","GlitterWASM","then","Module","console","log","onWasmInit","_Module","_init","cwrap","_track","track","im_arr","quads","im_ptr","_malloc","length","HEAPU8","set","ptr","ptrF64","Float64Array","BYTES_PER_ELEMENT","numQuads","getValue","i","q","p00","HEAPF64","p01","p10","p11","p20","p21","p30","p31","c0","c1","push","_free","GrayScaleMedia","source","document","createElement","flipProg","require","grayProg","positionLocation","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","flipLocation","getUniformLocation","uniform1f","glReady","pixelBuf","Uint8ClampedArray","grayBuf","getPixels","undefined","j","requestStream","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","aspect","Utils","isMobile","audio","video","ideal","aspectRatio","facingMode","stream","srcObject","onloadedmetadata","e","play","catch","err","test","userAgent"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAO,MAAMA,OAAN,CAAc;AACjB,SAAOC,QAAP,CAAgBC,MAAhB,EAAwBC,KAAxB,EAA+BC,MAA/B,EAAuC;AACnC,UAAMC,EAAE,GAAGH,MAAM,CAACI,UAAP,CAAkB,OAAlB,CAAX;AACAD,MAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBJ,KAAlB,EAAyBC,MAAzB;AACAC,MAAE,CAACG,UAAH,CAAc,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,GAA7B;AACAH,MAAE,CAACI,KAAH,CAASJ,EAAE,CAACK,gBAAZ;AACA,UAAMC,QAAQ,GAAG,IAAIC,YAAJ,CAAiB,CAC9B,CAAC,CAD6B,EAC1B,CAAC,CADyB,EAE9B,CAAC,CAF6B,EAEzB,CAFyB,EAG7B,CAH6B,EAGzB,CAHyB,EAI9B,CAAC,CAJ6B,EAI1B,CAAC,CAJyB,EAK7B,CAL6B,EAKzB,CALyB,EAM7B,CAN6B,EAM1B,CAAC,CANyB,CAAjB,CAAjB;AAQA,UAAMC,MAAM,GAAGR,EAAE,CAACS,YAAH,EAAf;AACAT,MAAE,CAACU,UAAH,CAAcV,EAAE,CAACW,YAAjB,EAA+BH,MAA/B;AACAR,MAAE,CAACY,UAAH,CAAcZ,EAAE,CAACW,YAAjB,EAA+BL,QAA/B,EAAyCN,EAAE,CAACa,WAA5C;AACA,WAAOb,EAAP;AACH;;AAED,SAAOc,YAAP,CAAoBd,EAApB,EAAwBe,IAAxB,EAA8BC,UAA9B,EAA0C;AACtC,UAAMC,MAAM,GAAGjB,EAAE,CAACc,YAAH,CAAgBC,IAAhB,CAAf;AAEAf,MAAE,CAACkB,YAAH,CAAgBD,MAAhB,EAAwBD,UAAxB;AACAhB,MAAE,CAACmB,aAAH,CAAiBF,MAAjB;AAEA,WAAOA,MAAP;AACH;;AAED,SAAOG,aAAP,CAAqBpB,EAArB,EAAyBqB,cAAzB,EAAyCC,cAAzC,EAAyD;AACrD,UAAMC,UAAU,GAAG5B,OAAO,CAACmB,YAAR,CAAqBd,EAArB,EAAyBA,EAAE,CAACwB,aAA5B,EAA2CH,cAA3C,CAAnB;AACA,UAAMI,UAAU,GAAG9B,OAAO,CAACmB,YAAR,CAAqBd,EAArB,EAAyBA,EAAE,CAAC0B,eAA5B,EAA6CJ,cAA7C,CAAnB;AAEA,UAAMK,OAAO,GAAG3B,EAAE,CAACoB,aAAH,EAAhB;AACApB,MAAE,CAAC4B,YAAH,CAAgBD,OAAhB,EAAyBJ,UAAzB;AACAvB,MAAE,CAAC4B,YAAH,CAAgBD,OAAhB,EAAyBF,UAAzB;AAEAzB,MAAE,CAAC6B,WAAH,CAAeF,OAAf;AAEA,WAAOA,OAAP;AACH;;AAED,SAAOG,UAAP,CAAkB9B,EAAlB,EAAsB2B,OAAtB,EAA+B;AAC3B3B,MAAE,CAAC8B,UAAH,CAAcH,OAAd;AACH;;AAED,SAAOI,aAAP,CAAqB/B,EAArB,EAAyBF,KAAzB,EAAgCC,MAAhC,EAAwC;AACpC,UAAMiC,OAAO,GAAGhC,EAAE,CAAC+B,aAAH,EAAhB;AAEA/B,MAAE,CAACiC,WAAH,CAAejC,EAAE,CAACkC,UAAlB,EAA8BF,OAA9B,EAHoC,CAKpC;;AACAhC,MAAE,CAACmC,aAAH,CAAiBnC,EAAE,CAACkC,UAApB,EAAgClC,EAAE,CAACoC,cAAnC,EAAmDpC,EAAE,CAACqC,aAAtD;AACArC,MAAE,CAACmC,aAAH,CAAiBnC,EAAE,CAACkC,UAApB,EAAgClC,EAAE,CAACsC,cAAnC,EAAmDtC,EAAE,CAACqC,aAAtD;AACArC,MAAE,CAACmC,aAAH,CAAiBnC,EAAE,CAACkC,UAApB,EAAgClC,EAAE,CAACuC,kBAAnC,EAAuDvC,EAAE,CAACwC,OAA1D;AACAxC,MAAE,CAACmC,aAAH,CAAiBnC,EAAE,CAACkC,UAApB,EAAgClC,EAAE,CAACyC,kBAAnC,EAAuDzC,EAAE,CAACwC,OAA1D;AAEAxC,MAAE,CAAC0C,UAAH,CAAc1C,EAAE,CAACkC,UAAjB,EAA6B,CAA7B,EAAgClC,EAAE,CAAC2C,IAAnC,EAAyC7C,KAAzC,EAAgDC,MAAhD,EAAwD,CAAxD,EAA2DC,EAAE,CAAC2C,IAA9D,EAAoE3C,EAAE,CAAC4C,aAAvE,EAAsF,IAAtF;AAEA5C,MAAE,CAACiC,WAAH,CAAejC,EAAE,CAACkC,UAAlB,EAA8B,IAA9B;AACA,WAAOF,OAAP;AACH;;AAED,SAAOC,WAAP,CAAmBjC,EAAnB,EAAuBgC,OAAvB,EAAgC;AAC5BhC,MAAE,CAACiC,WAAH,CAAejC,EAAE,CAACkC,UAAlB,EAA8BF,OAA9B;AACA,WAAOA,OAAP;AACH;;AAED,SAAOa,QAAP,CAAgB7C,EAAhB,EAAoB8C,IAApB,EAA0B;AACtB9C,MAAE,CAAC0C,UAAH,CACI1C,EAAE,CAACkC,UADP,EACmB,CADnB,EACsBlC,EAAE,CAAC2C,IADzB,EAC+B3C,EAAE,CAAC2C,IADlC,EACwC3C,EAAE,CAAC4C,aAD3C,EAC0DE,IAD1D;AAEH;;AAED,SAAOC,UAAP,CAAkB/C,EAAlB,EAAsB8C,IAAtB,EAA4B;AACxB9C,MAAE,CAACgD,aAAH,CACIhD,EAAE,CAACkC,UADP,EACmB,CADnB,EACsB,CADtB,EACyB,CADzB,EAC4BlC,EAAE,CAAC2C,IAD/B,EACqC3C,EAAE,CAAC4C,aADxC,EACuDE,IADvD;AAEH;;AAED,SAAOG,cAAP,CAAsBjD,EAAtB,EAA0BgC,OAA1B,EAAmC;AAC/BhC,MAAE,CAACkD,aAAH,CAAiBlB,OAAjB;AACH;;AAED,SAAOmB,iBAAP,CAAyBnD,EAAzB,EAA6BgC,OAA7B,EAAsC;AAClC,UAAMoB,GAAG,GAAGpD,EAAE,CAACmD,iBAAH,EAAZ;AACAnD,MAAE,CAACqD,eAAH,CAAmBrD,EAAE,CAACsD,WAAtB,EAAmCF,GAAnC;AACApD,MAAE,CAACuD,oBAAH,CACIvD,EAAE,CAACsD,WADP,EACoBtD,EAAE,CAACwD,iBADvB,EAC0CxD,EAAE,CAACkC,UAD7C,EACyDF,OADzD,EACkE,CADlE;AAEA,WAAOoB,GAAP;AACH;;AAED,SAAOK,kBAAP,CAA0BzD,EAA1B,EAA8BoD,GAA9B,EAAmC;AAC/BpD,MAAE,CAAC0D,iBAAH,CAAqBN,GAArB;AACH;;AAED,SAAOO,IAAP,CAAY3D,EAAZ,EAAgB;AACZA,MAAE,CAAC4D,UAAH,CAAc5D,EAAE,CAAC6D,SAAjB,EAA4B,CAA5B,EAA+B,CAA/B;AACH;;AAED,SAAOC,UAAP,CAAkB9D,EAAlB,EAAsBF,KAAtB,EAA6BC,MAA7B,EAAqCS,MAArC,EAA6C;AACzCR,MAAE,CAAC8D,UAAH,CACI,CADJ,EACO,CADP,EACUhE,KADV,EACiBC,MADjB,EACyBC,EAAE,CAAC2C,IAD5B,EACkC3C,EAAE,CAAC4C,aADrC,EACoDpC,MADpD;AAEH;;AArGgB,C;;;;;;;;;;;;ACArB;AAAA;AAAO,MAAMuD,eAAN,CAAsB;AACzBC,aAAW,CAACC,IAAD,EAAOC,QAAP,EAAiB;AACxB,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,KAAL,GAAa,KAAb;AACA,SAAKC,WAAL,GAAmB,KAAnB;AACA,SAAKC,WAAL,GAAmB,KAAnB;AACA,SAAKL,IAAL,GAAYA,IAAZ;AAEAM,eAAW,GAAGC,IAAd,CAAmB,UAAUC,MAAV,EAAkB;AACjCC,aAAO,CAACC,GAAR,CAAY,6BAAZ;;AACAR,WAAK,CAACS,UAAN,CAAiBH,MAAjB;;AACA,UAAIP,QAAJ,EAAcA,QAAQ;AACzB,KAJD;AAKH;;AAEDU,YAAU,CAACH,MAAD,EAAS;AACf,SAAKI,OAAL,GAAeJ,MAAf;AACA,SAAKK,KAAL,GAAaL,MAAM,CAACM,KAAP,CAAa,MAAb,EAAqB,QAArB,EAA+B,CAAC,QAAD,CAA/B,CAAb;AACA,SAAKC,MAAL,GAAc,KAAKH,OAAL,CAAaE,KAAb,CAAmB,OAAnB,EAA4B,QAA5B,EAAsC,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,CAAtC,CAAd;AACA,SAAKX,KAAL,GAAc,KAAKU,KAAL,CAAW,KAAKb,IAAhB,KAAyB,CAAvC;AACH;;AAEDgB,OAAK,CAACC,MAAD,EAASpF,KAAT,EAAgBC,MAAhB,EAAwB;AACzB,QAAIoF,KAAK,GAAG,EAAZ;AACA,QAAI,CAAC,KAAKf,KAAV,EAAiB,OAAOe,KAAP;;AAEjB,UAAMC,MAAM,GAAG,KAAKP,OAAL,CAAaQ,OAAb,CAAqBH,MAAM,CAACI,MAA5B,CAAf;;AACA,SAAKT,OAAL,CAAaU,MAAb,CAAoBC,GAApB,CAAwBN,MAAxB,EAAgCE,MAAhC;;AAEA,UAAMK,GAAG,GAAG,KAAKT,MAAL,CAAYI,MAAZ,EAAoBtF,KAApB,EAA2BC,MAA3B,CAAZ;;AACA,UAAM2F,MAAM,GAAGD,GAAG,GAAGE,YAAY,CAACC,iBAAlC;;AAEA,UAAMC,QAAQ,GAAG,KAAKhB,OAAL,CAAaiB,QAAb,CAAsBL,GAAtB,EAA2B,QAA3B,CAAjB,CAVyB,CAWzB;;;AAEA,SAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,QAApB,EAA8BE,CAAC,EAA/B,EAAmC;AAC/B,UAAIC,CAAC,GAAG;AACJC,WAAG,EAAG,KAAKpB,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CADF;AAEJI,WAAG,EAAG,KAAKtB,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CAFF;AAGJK,WAAG,EAAG,KAAKvB,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CAHF;AAIJM,WAAG,EAAG,KAAKxB,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CAJF;AAKJO,WAAG,EAAG,KAAKzB,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CALF;AAMJQ,WAAG,EAAG,KAAK1B,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CANF;AAOJS,WAAG,EAAG,KAAK3B,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CAPF;AAQJU,WAAG,EAAG,KAAK5B,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CARF;AASJW,UAAE,EAAI,KAAK7B,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC,CATF;AAUJY,UAAE,EAAI,KAAK9B,OAAL,CAAaqB,OAAb,CAAqBR,MAAM,GAAC,KAAGK,CAAV,GAAY,CAAZ,GAAc,CAAnC;AAVF,OAAR;AAYAZ,WAAK,CAACyB,IAAN,CAAWZ,CAAX;AACH;;AAED,SAAKnB,OAAL,CAAagC,KAAb,CAAmBpB,GAAnB;;AACA,SAAKZ,OAAL,CAAagC,KAAb,CAAmBzB,MAAnB;;AAEA,WAAOD,KAAP;AACH;;AAvDwB,C;;;;;;;;;;;;ACA7B;AAAA;AAAA;AAAA;AAAA;AACA;AAEO,MAAM2B,cAAN,CAAqB;AACxB9C,aAAW,CAAC+C,MAAD,EAASjH,KAAT,EAAgBC,MAAhB,EAAwBF,MAAxB,EAAgC;AACvC,SAAKkH,MAAL,GAAcA,MAAd;AAEA,SAAKjH,KAAL,GAAaA,KAAb;AACA,SAAKC,MAAL,GAAcA,MAAd;AAEA,SAAKF,MAAL,GAAcA,MAAM,GAAGA,MAAH,GAAYmH,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAhC;AACA,SAAKpH,MAAL,CAAYC,KAAZ,GAAoB,KAAKA,KAAzB;AACA,SAAKD,MAAL,CAAYE,MAAZ,GAAqB,KAAKA,MAA1B;AAEA,SAAKC,EAAL,GAAUL,iDAAO,CAACC,QAAR,CAAiB,KAAKC,MAAtB,EAA8B,KAAKC,KAAnC,EAA0C,KAAKC,MAA/C,CAAV;;AAEA,UAAMmH,QAAQ,GAAGC,mBAAO,CAAC,+DAAD,CAAxB;;AACA,UAAMC,QAAQ,GAAGD,mBAAO,CAAC,6DAAD,CAAxB;;AACA,UAAMxF,OAAO,GAAGhC,iDAAO,CAACyB,aAAR,CAAsB,KAAKpB,EAA3B,EAA+BkH,QAA/B,EAAyCE,QAAzC,CAAhB;AACAzH,qDAAO,CAACmC,UAAR,CAAmB,KAAK9B,EAAxB,EAA4B2B,OAA5B;AAEA,UAAM0F,gBAAgB,GAAG,KAAKrH,EAAL,CAAQsH,iBAAR,CAA0B3F,OAA1B,EAAmC,UAAnC,CAAzB;AACA,SAAK3B,EAAL,CAAQuH,mBAAR,CAA4BF,gBAA5B,EAA8C,CAA9C,EAAiD,KAAKrH,EAAL,CAAQwH,KAAzD,EAAgE,KAAhE,EAAuE,CAAvE,EAA0E,CAA1E;AACA,SAAKxH,EAAL,CAAQyH,uBAAR,CAAgCJ,gBAAhC;AAEA,UAAMK,YAAY,GAAG,KAAK1H,EAAL,CAAQ2H,kBAAR,CAA2BhG,OAA3B,EAAoC,OAApC,CAArB;AACA,SAAK3B,EAAL,CAAQ4H,SAAR,CAAkBF,YAAlB,EAAgC,CAAC,CAAjC,EAtBuC,CAsBF;;AAErC,SAAK1F,OAAL,GAAerC,iDAAO,CAACoC,aAAR,CAAsB,KAAK/B,EAA3B,EAA+B,KAAKF,KAApC,EAA2C,KAAKC,MAAhD,CAAf;AACAJ,qDAAO,CAACsC,WAAR,CAAoB,KAAKjC,EAAzB,EAA6B,KAAKgC,OAAlC;AAEA,SAAK6F,OAAL,GAAe,IAAf;AACA,SAAKC,QAAL,GAAgB,IAAIC,iBAAJ,CAAsB,KAAKjI,KAAL,GAAa,KAAKC,MAAlB,GAA2B,CAAjD,CAAhB;AACA,SAAKiI,OAAL,GAAe,IAAID,iBAAJ,CAAsB,KAAKjI,KAAL,GAAa,KAAKC,MAAxC,CAAf;AACH;;AAEDkI,WAAS,GAAG;AACR,QAAI,CAAC,KAAKJ,OAAV,EAAmB,OAAOK,SAAP;AAEnBvI,qDAAO,CAACoD,UAAR,CAAmB,KAAK/C,EAAxB,EAA4B,KAAK+G,MAAjC;AACApH,qDAAO,CAACgE,IAAR,CAAa,KAAK3D,EAAlB;AACAL,qDAAO,CAACmE,UAAR,CAAmB,KAAK9D,EAAxB,EAA4B,KAAKF,KAAjC,EAAwC,KAAKC,MAA7C,EAAqD,KAAK+H,QAA1D;AAEA,QAAIK,CAAC,GAAG,CAAR;;AACA,SAAK,IAAIpC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK+B,QAAL,CAAcxC,MAAlC,EAA0CS,CAAC,IAAI,CAA/C,EAAkD;AAC9C,WAAKiC,OAAL,CAAaG,CAAb,IAAkB,KAAKL,QAAL,CAAc/B,CAAd,CAAlB;AACAoC,OAAC;AACJ;;AACD,WAAO,KAAKH,OAAZ;AACH;;AAEDI,eAAa,GAAG;AACZ,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,UAAI,CAACC,SAAS,CAACC,YAAX,IAA2B,CAACD,SAAS,CAACC,YAAV,CAAuBC,YAAvD,EACI,OAAOH,MAAM,EAAb,CAFgC,CAIpC;;AACA,UAAII,MAAM,GAAG,KAAK7I,KAAL,GAAa,KAAKC,MAA/B;;AACA,UAAI6I,4CAAK,CAACC,QAAN,EAAJ,EAAsB;AAClBF,cAAM,GAAG,IAAIA,MAAb;AACH;;AAEDH,eAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;AAChCI,aAAK,EAAE,KADyB;AAEhCC,aAAK,EAAE;AACHjJ,eAAK,EAAE;AAAEkJ,iBAAK,EAAE,KAAKlJ;AAAd,WADJ;AAEHC,gBAAM,EAAE;AAAEiJ,iBAAK,EAAE,KAAKjJ;AAAd,WAFL;AAGHkJ,qBAAW,EAAE;AAAED,iBAAK,EAAEL;AAAT,WAHV;AAIHO,oBAAU,EAAE;AAJT;AAFyB,OAApC,EASC1E,IATD,CASM2E,MAAM,IAAI;AACZ,aAAKpC,MAAL,CAAYqC,SAAZ,GAAwBD,MAAxB;;AACA,aAAKpC,MAAL,CAAYsC,gBAAZ,GAA+BC,CAAC,IAAI;AAChC,eAAKvC,MAAL,CAAYwC,IAAZ;AACA5J,2DAAO,CAACkD,QAAR,CAAiB,KAAK7C,EAAtB,EAA0B,KAAK+G,MAA/B;AACAuB,iBAAO,CAAC,KAAKvB,MAAN,CAAP;AACH,SAJD;AAKH,OAhBD,EAiBCyC,KAjBD,CAiBOC,GAAG,IAAI;AACVlB,cAAM,CAACkB,GAAD,CAAN;AACH,OAnBD;AAoBH,KA9BM,CAAP;AA+BH;;AAhFuB,C;;;;;;;;;;;;ACH5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;ACDA,0CAA0C,0BAA0B,sBAAsB,mBAAmB,sCAAsC,oCAAoC,0DAA0D,GAAG,C;;;;;;;;;;;ACApP,wCAAwC,4BAA4B,0BAA0B,2CAA2C,mBAAmB,8CAA8C,iCAAiC,uCAAuC,GAAG,C;;;;;;;;;;;;ACArR;AAAA;AAAO,MAAMb,KAAN,CAAY;AACf,SAAOC,QAAP,GAAmB;AACf,WAAO,8BAA8Ba,IAA9B,CAAmClB,SAAS,CAACmB,SAA7C,CAAP;AACH;;AAHc,C","file":"glitter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Glitter\"] = factory();\n\telse\n\t\troot[\"Glitter\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/index.js\");\n","export class GLUtils {\n    static createGL(canvas, width, height) {\n        const gl = canvas.getContext(\"webgl\");\n        gl.viewport(0, 0, width, height);\n        gl.clearColor(0.1, 0.1, 0.1, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        const vertices = new Float32Array([\n            -1, -1,\n            -1,  1,\n             1,  1,\n            -1, -1,\n             1,  1,\n             1, -1,\n        ]);\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n        return gl;\n    }\n\n    static createShader(gl, type, shaderProg) {\n        const shader = gl.createShader(type);\n\n        gl.shaderSource(shader, shaderProg);\n        gl.compileShader(shader);\n\n        return shader;\n    }\n\n    static createProgram(gl, vertShaderProg, fragShaderProg) {\n        const vertShader = GLUtils.createShader(gl, gl.VERTEX_SHADER, vertShaderProg);\n        const fragShader = GLUtils.createShader(gl, gl.FRAGMENT_SHADER, fragShaderProg);\n\n        const program = gl.createProgram();\n        gl.attachShader(program, vertShader);\n        gl.attachShader(program, fragShader);\n\n        gl.linkProgram(program);\n\n        return program;\n    }\n\n    static useProgram(gl, program) {\n        gl.useProgram(program);\n    }\n\n    static createTexture(gl, width, height) {\n        const texture = gl.createTexture();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n\n        // if either dimension of image is not a power of 2\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n\n    static bindTexture(gl, texture) {\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        return texture;\n    }\n\n    static bindElem(gl, elem) {\n        gl.texImage2D(\n            gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, elem);\n    }\n\n    static updateElem(gl, elem) {\n        gl.texSubImage2D(\n            gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, elem);\n    }\n\n    static destroyTexture(gl, texture) {\n        gl.deleteTexture(texture);\n    }\n\n    static createFramebuffer(gl, texture) {\n        const fbo = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n        gl.framebufferTexture2D(\n            gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n        return fbo;\n    }\n\n    static destroyFramebuffer(gl, fbo) {\n        gl.deleteFramebuffer(fbo);\n    }\n\n    static draw(gl) {\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    static readPixels(gl, width, height, buffer) {\n        gl.readPixels(\n            0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, buffer);\n    }\n}\n","export class GlitterDetector {\n    constructor(code, callback) {\n        let _this = this;\n        this.ready = false;\n        this.shouldTrack = false;\n        this.validPoints = false;\n        this.code = code;\n\n        GlitterWASM().then(function (Module) {\n            console.log(\"GLITTER WASM module loaded.\");\n            _this.onWasmInit(Module);\n            if (callback) callback();\n        });\n    }\n\n    onWasmInit(Module) {\n        this._Module = Module;\n        this._init = Module.cwrap(\"init\", \"number\", [\"number\"]);\n        this._track = this._Module.cwrap(\"track\", \"number\", [\"number\", \"number\", \"number\"]);\n        this.ready = (this._init(this.code) == 0);\n    }\n\n    track(im_arr, width, height) {\n        let quads = [];\n        if (!this.ready) return quads;\n\n        const im_ptr = this._Module._malloc(im_arr.length);\n        this._Module.HEAPU8.set(im_arr, im_ptr);\n\n        const ptr = this._track(im_ptr, width, height);\n        const ptrF64 = ptr / Float64Array.BYTES_PER_ELEMENT;\n\n        const numQuads = this._Module.getValue(ptr, \"double\");\n        // console.log(\"numQuads = \", numQuads);\n\n        for (var i = 0; i < numQuads; i++) {\n            var q = {\n                p00 : this._Module.HEAPF64[ptrF64+10*i+1+0],\n                p01 : this._Module.HEAPF64[ptrF64+10*i+1+1],\n                p10 : this._Module.HEAPF64[ptrF64+10*i+1+2],\n                p11 : this._Module.HEAPF64[ptrF64+10*i+1+3],\n                p20 : this._Module.HEAPF64[ptrF64+10*i+1+4],\n                p21 : this._Module.HEAPF64[ptrF64+10*i+1+5],\n                p30 : this._Module.HEAPF64[ptrF64+10*i+1+6],\n                p31 : this._Module.HEAPF64[ptrF64+10*i+1+7],\n                c0  : this._Module.HEAPF64[ptrF64+10*i+1+8],\n                c1  : this._Module.HEAPF64[ptrF64+10*i+1+9],\n            };\n            quads.push(q);\n        }\n\n        this._Module._free(ptr);\n        this._Module._free(im_ptr);\n\n        return quads;\n    }\n}\n","import {Utils} from './utils';\nimport {GLUtils} from './gl-utils';\n\nexport class GrayScaleMedia {\n    constructor(source, width, height, canvas) {\n        this.source = source;\n\n        this.width = width;\n        this.height = height;\n\n        this.canvas = canvas ? canvas : document.createElement(\"canvas\");\n        this.canvas.width = this.width;\n        this.canvas.height = this.height;\n\n        this.gl = GLUtils.createGL(this.canvas, this.width, this.height);\n\n        const flipProg = require(\"./shaders/flip-image.glsl\");\n        const grayProg = require(\"./shaders/grayscale.glsl\");\n        const program = GLUtils.createProgram(this.gl, flipProg, grayProg);\n        GLUtils.useProgram(this.gl, program);\n\n        const positionLocation = this.gl.getAttribLocation(program, \"position\");\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n        this.gl.enableVertexAttribArray(positionLocation);\n\n        const flipLocation = this.gl.getUniformLocation(program, \"flipY\");\n        this.gl.uniform1f(flipLocation, -1); // flip image\n\n        this.texture = GLUtils.createTexture(this.gl, this.width, this.height);\n        GLUtils.bindTexture(this.gl, this.texture);\n\n        this.glReady = true;\n        this.pixelBuf = new Uint8ClampedArray(this.width * this.height * 4);\n        this.grayBuf = new Uint8ClampedArray(this.width * this.height);\n    }\n\n    getPixels() {\n        if (!this.glReady) return undefined;\n\n        GLUtils.updateElem(this.gl, this.source);\n        GLUtils.draw(this.gl);\n        GLUtils.readPixels(this.gl, this.width, this.height, this.pixelBuf);\n\n        let j = 0;\n        for (let i = 0; i < this.pixelBuf.length; i += 4) {\n            this.grayBuf[j] = this.pixelBuf[i];\n            j++;\n        }\n        return this.grayBuf;\n    }\n\n    requestStream() {\n        return new Promise((resolve, reject) => {\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n                return reject();\n\n            // Hack for mobile browsers: aspect ratio is flipped.\n            var aspect = this.width / this.height;\n            if (Utils.isMobile()) {\n                aspect = 1 / aspect;\n            }\n\n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { ideal: this.width },\n                    height: { ideal: this.height },\n                    aspectRatio: { ideal: aspect },\n                    facingMode: \"environment\"\n                }\n            })\n            .then(stream => {\n                this.source.srcObject = stream;\n                this.source.onloadedmetadata = e => {\n                    this.source.play();\n                    GLUtils.bindElem(this.gl, this.source);\n                    resolve(this.source);\n                };\n            })\n            .catch(err => {\n                reject(err);\n            });\n        });\n    }\n}\n","import {GrayScaleMedia} from \"./grayscale\"\nimport {GlitterDetector} from \"./glitter-detector\"\n\nexport {\n    GrayScaleMedia, GlitterDetector\n}\n","module.exports = \"attribute vec2 position;\\nvarying vec2 tex_coords;\\nuniform float flipY;\\nvoid main(void) {\\ntex_coords = (position + 1.0) / 2.0;\\ntex_coords.y = 1.0 - tex_coords.y;\\ngl_Position = vec4(position * vec2(1, flipY), 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nuniform sampler2D u_image;\\nvarying vec2 tex_coords;\\nconst vec3 g = vec3(0.299, 0.587, 0.114);\\nvoid main(void) {\\nvec4 color = texture2D(u_image, tex_coords);\\nfloat gray = dot(color.rgb, g);\\ngl_FragColor = vec4(vec3(gray), 1.0);\\n}\"","export class Utils {\n    static isMobile () {\n        return /Android|mobile|iPad|iPhone/i.test(navigator.userAgent);\n    }\n}\n"],"sourceRoot":""}